<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Missing Dates Finder</title>

  <!-- Moment.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Flatpickr -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/airbnb.css">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

  <style>
    .flatpickr-calendar {
      font-family: 'Inter', sans-serif;
      border-radius: 1rem !important;
      box-shadow: 0 10px 30px rgba(0,0,0,.2) !important;
      overflow: hidden;
      border: none !important;
    }
    .flatpickr-months {
      background: linear-gradient(to right, #3b82f6, #2563eb) !important;
      color: white;
      padding: .5rem 0;
    }
    .flatpickr-day {
      border-radius: .75rem !important;
      transition: all .2s ease;
    }
    .flatpickr-day:hover {
      background: #3b82f6 !important;
      color: white !important;
      transform: scale(1.05);
    }
    .flatpickr-day.today {
      border: 2px solid #2563eb !important;
      font-weight: bold;
      color: #2563eb !important;
    }
    .flatpickr-day.selected {
      background: #2563eb !important;
      color: white !important;
      box-shadow: 0 2px 6px rgba(0,0,0,.25);
    }
  </style>
</head>
<body class="bg-gradient-to-br from-gray-100 to-gray-200 min-h-screen flex items-center justify-center p-4">

  <!-- Wrapper -->
  <div id="wrapper" class="w-full max-w-6xl flex justify-center transition-all duration-700 ease-in-out">

    <!-- Input Panel -->
    <div id="inputPanel" class="w-full max-w-md bg-white p-8 rounded-xl shadow-lg transition-all duration-700 ease-in-out">
      <h1 class="text-3xl font-extrabold mb-6 text-gray-800 text-center">Missing Dates Finder</h1>

      <!-- Input Dates -->
      <div class="mb-6">
        <label class="block text-sm font-semibold text-gray-600 mb-2">Enter Dates (one per line, first date = start)</label>
        <textarea id="inputDates" rows="5"
          class="mt-1 p-3 w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-blue-400 transition"
          placeholder="e.g. 01/01/2023&#10;01/03/2023"></textarea>
      </div>

      <!-- End Date -->
      <div class="mb-6">
        <label class="block text-sm font-semibold text-gray-600 mb-2">End Date (select or type)</label>
        <input type="text" id="endDate"
          class="mt-1 p-3 w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-blue-400 transition"
          data-flatpickr>
        <small id="endDateError" class="text-red-500 hidden">âš  Please Enter End Date</small>
      </div>

      <!-- Date Format -->
      <div class="mb-6">
        <label class="block text-sm font-semibold text-gray-600 mb-2">Date Format</label>
        <select id="dateFormat" onchange="applyDateFormat()"
          class="mt-1 p-3 w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-blue-400 transition">
          <option value="DD/MM/YYYY">DD/MM/YYYY</option>
          <option value="MM/DD/YYYY">MM/DD/YYYY</option>
        </select>
      </div>

      <!-- Button -->
      <button onclick="findMissingDates({animate:true})"
        class="w-full text-white p-3 rounded-lg font-semibold 
               bg-gradient-to-r from-blue-500 to-blue-600 
               transition-all duration-300 
               hover:from-blue-600 hover:to-blue-700 
               hover:shadow-xl hover:scale-105">
        Find Missing Dates
      </button>
    </div>

    <!-- Missing Dates Panel -->
    <div id="resultPanel" 
         class="w-full max-w-md bg-white p-8 rounded-xl shadow-lg opacity-0 translate-x-20 transition-all duration-700 ease-in-out hidden">
      <h2 class="text-2xl font-bold text-gray-700 mb-4">Missing Dates:</h2>
      <ul id="missingDatesList" class="list-disc pl-6 text-gray-600 space-y-1 max-h-[400px] overflow-y-auto"></ul>

      <!-- Refresh Button (small) -->
      <div class="flex justify-center">
        <button onclick="location.reload()" 
          class="mt-6 px-4 py-2 text-sm text-white rounded-lg font-semibold 
                 bg-gradient-to-r from-green-500 to-green-600 
                 transition-all duration-300 
                 hover:from-green-600 hover:to-green-700 
                 hover:shadow-lg hover:scale-105">
          ðŸ”„ Refresh
        </button>
      </div>
    </div>
  </div>

<script>
  let flatpickrInstance;
  let currentFormat = 'DD/MM/YYYY';
  let endDateValue = null; // keep moment object internally

  const toFlatpickrFmt = (fmt) =>
    fmt.replace('YYYY','Y').replace('MM','m').replace('DD','d');

  const altFormatOf = (fmt) => (fmt === 'DD/MM/YYYY' ? 'MM/DD/YYYY' : 'DD/MM/YYYY');

  function initializeFlatpickr() {
    const fpFmt = toFlatpickrFmt(currentFormat);
    if (flatpickrInstance) flatpickrInstance.destroy();
    flatpickrInstance = flatpickr('#endDate', {
      dateFormat: fpFmt,
      allowInput: true,
      monthSelectorType: "dropdown",
      onChange: (selDates) => {
        if (selDates.length > 0) {
          endDateValue = moment(selDates[0]);
          document.getElementById('endDate').value = endDateValue.format(currentFormat);
        }
      }
    });
  }

  function parseFlexible(str) {
    const m = moment(str, [currentFormat, altFormatOf(currentFormat)], true);
    return m.isValid() ? m : null;
  }

  function applyDateFormat() {
    const newFormat = document.getElementById('dateFormat').value;
    const inputTextarea = document.getElementById('inputDates');
    const endDateInput = document.getElementById('endDate');
    const errorEl = document.getElementById('endDateError');

    const oldFormat = currentFormat;
    currentFormat = newFormat;

    // Convert textarea dates
    const lines = inputTextarea.value.split('\n');
    inputTextarea.value = lines.map((raw) => {
      const m = moment(raw.trim(), [oldFormat, altFormatOf(oldFormat), newFormat], true);
      return m.isValid() ? m.format(newFormat) : raw.trim();
    }).join('\n');

    // Convert end date using stored moment
    if (endDateValue && endDateValue.isValid()) {
      endDateInput.value = endDateValue.format(newFormat);
      errorEl.classList.add('hidden');
    } else if (endDateInput.value.trim()) {
      errorEl.classList.remove('hidden');
    }

    initializeFlatpickr();

    // Recompute results if already shown
    if (!document.getElementById('resultPanel').classList.contains('hidden')) {
      findMissingDates({animate:false});
    }
  }

  function findMissingDates({animate} = {animate:true}) {
    const inputDates = document.getElementById('inputDates').value
      .split('\n').map(v => v.trim()).filter(Boolean);
    const endDateStr = document.getElementById('endDate').value.trim();
    const errorEl = document.getElementById('endDateError');
    const missingDatesList = document.getElementById('missingDatesList');

    if (inputDates.length === 0) {
      alert('Please enter at least one date.');
      return;
    }

    const parsedNorm = [];
    for (let d of inputDates) {
      const m = parseFlexible(d);
      if (!m) {
        alert(`Invalid date: ${d}. Must match format: ${currentFormat}`);
        return;
      }
      parsedNorm.push(m.format(currentFormat));
    }

    const startDate = moment(parsedNorm[0], currentFormat, true);

    if (!endDateValue) {
      endDateValue = parseFlexible(endDateStr);
    }
    if (!endDateValue || !endDateValue.isValid()) {
      errorEl.classList.remove('hidden');
      return;
    }
    errorEl.classList.add('hidden');

    // Build range
    const fullRange = [];
    let cur = startDate.clone();
    while (cur <= endDateValue) {
      fullRange.push(cur.format(currentFormat));
      cur.add(1, 'days');
    }

    const missing = fullRange.filter(d => !parsedNorm.includes(d));

    missingDatesList.innerHTML = missing.length
      ? missing.map(d => `<li>${d}</li>`).join('')
      : '<li class="text-gray-500">No missing dates found.</li>';

    // Animate panels
    const inputPanel = document.getElementById('inputPanel');
    const resultPanel = document.getElementById('resultPanel');
    document.getElementById('wrapper').classList.add("gap-11");

    if (animate) inputPanel.classList.add("translate-x-[-20px]");
    resultPanel.classList.remove("hidden");

    setTimeout(() => {
      resultPanel.classList.remove("opacity-0", "translate-x-20");
    }, animate ? 50 : 0);
  }

  document.getElementById("endDate").addEventListener("blur", e => {
    const val = e.target.value.trim();
    const m = parseFlexible(val);
    if (m) {
      endDateValue = m;
      e.target.value = m.format(currentFormat); // normalize
    }
  });

  document.addEventListener('DOMContentLoaded', () => {
    initializeFlatpickr();
  });
</script>
</body>
</html>
